/*
 * kisaMetaka v0.3.1
 */
(function (e) {
	e.fn.kisaMetaka = function (t) {
		var n = e(this).get(0),
            r = false,
            i, s = new Audio;
		var o = {
			numberOfDrops: 50,
			speed: 10
		};
		e.extend(o, t);
		(function () {
			s.loop = true;
			if (o.sound) {
				if (s.canPlayType("audio/ogg")) {
					s.src = o.sound + ".ogg"
				} else if (s.canPlayType("audio/mp3")) {
					s.src = o.sound + ".mp3"
				}
			}
		})();
		var u = function () {
			var t, u = [];
			e(n).attr("width", e(window).width()).attr("height", e(window).height());
			e(window).resize(function () {
				e(n).attr("width", e(window).width()).attr("height", e(window).height())
			});
			var a = function () {
				t.clearRect(0, 0, t.canvas.width, t.canvas.height);
				for (var e = 0; e < o.numberOfDrops; e++) {
					t.drawImage(u[e].image, u[e].x, u[e].y);
					u[e].y += u[e].speed;
					if (u[e].y > t.canvas.height) {
						u[e].y = -25;
						u[e].x = Math.random() * t.canvas.width
					}
				}
			};
			if (n.getContext) {
				t = n.getContext("2d");
				for (var f = 0; f < o.numberOfDrops; f++) {
					var l = {};
					l.image = new Image;
					l.image.src = o.dropImage;
					l.x = Math.random() * t.canvas.width;
					l.y = Math.random() * t.canvas.height;
					l.speed = o.speed + Math.random() * o.speed;
					u.push(l)
				}
				if (!r) {
					e(n).show();
					i = setInterval(a, 35);
					if (s.src) {
						s.play()
					}
					r = true
				} else {
					e(n).hide();
					clearInterval(i);
					if (s.src) {
						s.pause()
					}
					r = false
				}
			}
		};
		(function () {
			var n = [];
			var r = function () {
				var e = 0;
				for (var t = 0; t < o.keys.length; t++) {
					if (n[o.keys[t]]) {
						e++
					}
				}
				return e === o.keys.length ? true : false
			};
			var i = function (e) {
				e = e || event;
				n[e.keyCode] = e.type == "keydown" ? true : false;
				if (r()) {
					u()
				}
			};
		    u();
		})();
		return this
	}
})(jQuery || {})